{% block _product_review_form_widget %}
    {% if is_granted('product_review_create') %}
        {{ form_start(form, {attr: {class: 'product-raiting__form', 'novalidate': 'novalidate'}}) }}
            <h3>{{ 'oro.translation.product_review_create_form.form_title'|trans }}</h3>
            <div class="form-row--rating">{{ form_row(form.rating) }}</div>

            <div class="star-review__wrapper">
                <label class="label label--full required">
                    {{ 'oro.translation.product_review_create_form.rating_label'|trans }}
                    <em>*</em>
                </label>
                <div class="star-review--input"
                     data-page-component-module="productreview/js/app/components/rating-component"
                     data-rate-value="0"
                >
                </div>
            </div>

            {{ form_row(form.comment) }}

            {% if app.user is null %}
                {{ form_row(form.author) }}
            {% endif %}

            {{ form_row(form.product) }}
            {{ form_row(form.customerUser) }}

            {% if isGoogleRecaptchaSettingsValid is defined and isGoogleRecaptchaSettingsValid %}
                {{ form_row(form.recaptchaResponse, { 'attr': {
                    'class': 'js-recaptcha-response',
                    'data-callback': 'setResponse'
                }}) }}
            {% else %}
                {{ form_row(form.recaptchaResponse) }}
            {% endif %}

            {{ form_row(form._token) }}

            {% if isGoogleRecaptchaSettingsValid is defined and isGoogleRecaptchaSettingsValid %}
                <div class="g-recaptcha"
                     data-sitekey="{{ googleRecaptchaSiteKey }}"
                     data-size="invisible"
                     data-callback="setResponse">
                </div>
            {% endif %}

            <button type="submit" class="btn btn-info">
                {{ 'oro.translation.product_review_create_form.submit_button_text'|trans }}
            </button>
        {{ form_end(form, {'render_rest': false}) }}

        {% if isGoogleRecaptchaSettingsValid is defined and isGoogleRecaptchaSettingsValid %}
            <script>
                // TODO: create separate js file
                window.onloadCallback = function() {
                    grecaptcha.execute();
                };

                function setResponse(response) {
                    document.getElementsByClassName('js-recaptcha-response')[0].value = response;
                }
            </script>
        {% endif %}
    {% endif %}
{% endblock %}
